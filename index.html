import React, { useState, useEffect, useMemo, useRef } from 'react';
import { 
  Clock, Calendar as CalendarIcon, Dumbbell, Code, Coffee, Moon, Sun, Heart, 
  Zap, ChevronRight, Info, ChevronLeft, Star, Ghost, MapPin, Bath, Utensils,
  Settings, Save, Download, Upload, Plus, Trash2, RefreshCw
} from 'lucide-react';

/**
 * ==========================================
 * UI ICON MAPPING
 * ==========================================
 * ‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏õ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠ Icon ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏õ‡πá‡∏ô String ‡πÉ‡∏ô Database/LocalStorage 
 * ‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô Component ‡∏Ç‡∏≠‡∏á Lucide-React ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
 */
const IconMap = {
  Zap, Clock, CalendarIcon, Dumbbell, Code, Coffee, Moon, Sun, Heart, 
  ChevronRight, Info, ChevronLeft, Star, Ghost, MapPin, Bath, Utensils, Settings, Save
};

const RenderIcon = ({ name, size = 16, className = "" }) => {
  const IconComponent = IconMap[name] || Info;
  return <IconComponent size={size} className={className} />;
};

/**
 * ==========================================
 * INITIAL DATA (‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏â‡∏ö‡∏±‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î 12 ‡∏ß‡∏±‡∏ô)
 * ==========================================
 * ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô "Lazy Morning Edition"
 */
const INITIAL_SCHEDULE = [
  {
    id: 1, title: '‡∏Å‡∏∞‡πÄ‡∏ä‡πâ‡∏≤ (Day 1-3) - ‡∏ß‡∏¥‡∏ô‡∏±‡∏¢‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠', type: 'morning_shift', days: [1, 2, 3],
    color: 'bg-yellow-50 border-yellow-200 text-yellow-800', accent: 'bg-yellow-500',
    routine: [
      { start: '05:45', end: '06:15', task: '‡∏ï‡∏∑‡πà‡∏ô / ‡∏≠‡∏≤‡∏ö‡∏ô‡πâ‡∏≥ / ‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡∏ß (Willpower ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)', icon: 'Zap' },
      { start: '06:15', end: '06:30', task: '‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á (15 ‡∏ô‡∏≤‡∏ó‡∏µ)', icon: 'MapPin' },
      { start: '06:30', end: '07:00', task: '‡∏ñ‡∏∂‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô / ‡∏£‡∏±‡∏ö‡πÄ‡∏ß‡∏£ / ‡∏î‡∏∑‡πà‡∏° Protein Shake', icon: 'Coffee' },
      { start: '07:00', end: '15:00', task: '‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡∏∞‡πÄ‡∏ä‡πâ‡∏≤ (‡∏û‡∏±‡∏Å‡∏Å‡∏¥‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á 1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)', icon: 'Code' },
      { start: '15:00', end: '15:15', task: '‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏¢‡∏¥‡∏° (15 ‡∏ô‡∏≤‡∏ó‡∏µ)', icon: 'MapPin' },
      { start: '15:15', end: '17:15', task: '‡∏¢‡∏¥‡∏° (Weight Training) - ‡πÄ‡∏ô‡πâ‡∏ô‡∏ó‡πà‡∏≤ Compound', icon: 'Dumbbell' },
      { start: '17:15', end: '17:45', task: '‡∏≠‡∏≤‡∏ö‡∏ô‡πâ‡∏≥‡∏ó‡∏µ‡πà‡∏¢‡∏¥‡∏° (‡∏•‡∏î‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡πâ‡∏≤‡∏ô)', icon: 'Bath' },
      { start: '17:45', end: '18:00', task: '‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô', icon: 'MapPin' },
      { start: '18:00', end: '19:00', task: '‡∏Å‡∏¥‡∏ô‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏¢‡πá‡∏ô (‡∏°‡∏∑‡πâ‡∏≠‡πÉ‡∏´‡∏ç‡πà) - ‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡πà‡∏°', icon: 'Utensils' },
      { start: '19:00', end: '22:15', task: '[‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô/Coding] ‡∏ó‡πâ‡∏≠‡∏á‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡πà‡∏≠‡∏¢ ‡∏´‡πâ‡∏≤‡∏°‡∏ô‡∏≠‡∏ô‡∏£‡∏≤‡∏ö!', icon: 'Code' },
      { start: '22:15', end: '05:45', task: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏ô‡∏≠‡∏ô (‡∏ô‡∏≠‡∏ô 7.5 ‡∏ä‡∏°.)', icon: 'Moon' },
    ]
  },
  {
    id: 2, title: '‡∏Å‡∏∞‡∏ö‡πà‡∏≤‡∏¢ (Day 4-6) - ‡∏ï‡∏∑‡πà‡∏ô‡∏™‡∏≤‡∏¢‡∏°‡∏µ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û', type: 'afternoon_shift', days: [4, 5, 6],
    color: 'bg-orange-50 border-orange-200 text-orange-800', accent: 'bg-orange-500',
    routine: [
      { start: '09:30', end: '10:15', task: '‡∏ï‡∏∑‡πà‡∏ô‡πÅ‡∏ö‡∏ö Lazy Morning / ‡∏à‡∏¥‡∏ö‡∏Å‡∏≤‡πÅ‡∏ü / ‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô', icon: 'Coffee' },
      { start: '10:15', end: '10:30', task: '‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏¢‡∏¥‡∏°', icon: 'MapPin' },
      { start: '10:30', end: '12:30', task: '‡∏¢‡∏¥‡∏° (Weight Training) ‡∏õ‡∏•‡∏∏‡∏Å‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢', icon: 'Dumbbell' },
      { start: '12:30', end: '13:00', task: '‡∏≠‡∏≤‡∏ö‡∏ô‡πâ‡∏≥‡∏ó‡∏µ‡πà‡∏¢‡∏¥‡∏°', icon: 'Bath' },
      { start: '13:00', end: '14:15', task: '‡∏Å‡∏¥‡∏ô‡∏°‡∏∑‡πâ‡∏≠‡πÉ‡∏´‡∏ç‡πà (‡∏°‡∏∑‡πâ‡∏≠‡∏´‡∏•‡∏±‡∏Å) ‡πÄ‡∏ô‡πâ‡∏ô‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏∞', icon: 'Utensils' },
      { start: '14:15', end: '14:30', task: '‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (15 ‡∏ô‡∏≤‡∏ó‡∏µ)', icon: 'MapPin' },
      { start: '15:00', end: '23:00', task: '‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡∏∞‡∏ö‡πà‡∏≤‡∏¢ (‡∏°‡∏∑‡πâ‡∏≠‡∏£‡∏≠‡∏á 19:00 ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ö‡∏≤‡πÜ)', icon: 'Code' },
      { start: '23:00', end: '23:15', task: '‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô', icon: 'MapPin' },
      { start: '23:15', end: '00:00', task: '‡∏≠‡∏≤‡∏ö‡∏ô‡πâ‡∏≥ / ‡∏°‡∏∑‡πâ‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏≠‡∏ô (‡πÄ‡∏ö‡∏≤‡∏°‡∏≤‡∏Å ‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏•‡∏±‡∏î)', icon: 'Utensils' },
      { start: '00:00', end: '02:00', task: '[‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏±‡∏Å/Coding] ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡∏™‡∏á‡∏ö Deep Work', icon: 'Code' },
      { start: '02:00', end: '09:30', task: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏ô‡∏≠‡∏ô', icon: 'Moon' },
    ]
  },
  {
    id: 3, title: '‡∏£‡∏≠‡∏¢‡∏ï‡πà‡∏≠ (Day 7) - ‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡∏á‡∏µ‡∏ö‡∏õ‡∏π‡∏û‡∏∑‡πâ‡∏ô', type: 'transition', days: [7],
    color: 'bg-blue-50 border-blue-200 text-blue-800', accent: 'bg-blue-500',
    routine: [
      { start: '10:00', end: '11:00', task: '‡∏ï‡∏∑‡πà‡∏ô‡∏ô‡∏≠‡∏ô / ‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡∏ï‡∏≤‡∏°‡∏≠‡∏±‡∏ò‡∏¢‡∏≤‡∏®‡∏±‡∏¢', icon: 'Sun' },
      { start: '11:00', end: '12:30', task: '‡∏ß‡∏¥‡πà‡∏á Easy Run (‡πÇ‡∏ã‡∏ô 2) ‡∏ä‡∏¥‡∏•‡πÜ', icon: 'Zap' },
      { start: '12:30', end: '13:30', task: '‡∏≠‡∏≤‡∏ö‡∏ô‡πâ‡∏≥ / ‡∏Å‡∏¥‡∏ô‡∏°‡∏∑‡πâ‡∏≠‡πÉ‡∏´‡∏ç‡πà', icon: 'Utensils' },
      { start: '13:30', end: '15:00', task: '‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô / Coding ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢', icon: 'Code' },
      { start: '15:00', end: '18:00', task: '‡∏ô‡∏≠‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô (Nap 3 ‡∏ä‡∏°.) ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πâ‡∏≤‡∏Å‡∏∞‡∏î‡∏∂‡∏Å', icon: 'Ghost' },
      { start: '18:00', end: '19:00', task: '‡∏ï‡∏∑‡πà‡∏ô‡∏°‡∏≤‡∏≠‡∏≤‡∏ö‡∏ô‡πâ‡∏≥ / ‡∏Å‡∏¥‡∏ô‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏¢‡πá‡∏ô', icon: 'Bath' },
      { start: '19:00', end: '22:30', task: '‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô / ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡πÅ‡∏ü‡∏ô ‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡∏ï‡∏∑‡πà‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏∞', icon: <Heart size={14} className="fill-rose-500 text-rose-500 inline"/> },
      { start: '23:00', end: '07:00', task: '‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡∏∞‡∏î‡∏∂‡∏Å‡∏Ñ‡∏∑‡∏ô‡∏ó‡∏µ‡πà 1 (‡∏°‡∏∑‡πâ‡∏≠‡∏î‡∏∂‡∏Å 01:00)', icon: 'Code' },
    ]
  },
  {
    id: 4, title: '‡∏Å‡∏∞‡∏î‡∏∂‡∏Å (Day 8-9) - ‡∏™‡∏π‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏á‡πà‡∏ß‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏ß‡∏¥‡πà‡∏á', type: 'night_shift', days: [8, 9],
    color: 'bg-indigo-50 border-indigo-200 text-indigo-800', accent: 'bg-indigo-500',
    routine: [
      { start: '07:15', end: '08:00', task: '‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô / ‡∏Å‡∏¥‡∏ô‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ä‡πâ‡∏≤ (‡∏°‡∏∑‡πâ‡∏≠‡πÉ‡∏´‡∏ç‡πà)', icon: 'Utensils' },
      { start: '08:00', end: '10:00', task: '‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô/Coding ‡∏£‡∏≠‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏¢‡πà‡∏≠‡∏¢', icon: 'Code' },
      { start: '10:00', end: '17:30', task: '‡∏ô‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏ö‡∏¢‡∏≤‡∏ß (‡∏°‡πà‡∏≤‡∏ô‡∏Å‡∏±‡∏ô‡πÅ‡∏™‡∏á 100%)', icon: 'Moon' },
      { start: '17:30', end: '18:30', task: '‡∏ß‡∏¥‡πà‡∏á Tempo (‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢)', icon: 'Zap' },
      { start: '18:30', end: '19:30', task: '‡∏≠‡∏≤‡∏ö‡∏ô‡πâ‡∏≥ / ‡∏Å‡∏¥‡∏ô‡∏°‡∏∑‡πâ‡∏≠‡πÉ‡∏´‡∏ç‡πà', icon: 'Utensils' },
      { start: '19:30', end: '22:30', task: '‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô / ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡πÅ‡∏ü‡∏ô / Coding', icon: 'Heart' },
      { start: '23:00', end: '07:00', task: '‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡∏∞‡∏î‡∏∂‡∏Å', icon: 'Code' },
    ]
  },
  {
    id: 5, title: '‡∏ß‡∏±‡∏ô OFF 1 (Day 10) - ‡∏Å‡∏π‡πâ‡∏ã‡∏≤‡∏Å‡πÅ‡∏•‡∏∞ Reset', type: 'off_day_1', days: [10],
    color: 'bg-emerald-50 border-emerald-200 text-emerald-800', accent: 'bg-emerald-500',
    routine: [
      { start: '07:15', end: '08:00', task: '‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô / ‡∏Å‡∏¥‡∏ô‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ä‡πâ‡∏≤ (‡πÄ‡∏ö‡∏≤‡πÜ)', icon: 'Coffee' },
      { start: '08:00', end: '12:00', task: 'Anchor Nap (4 ‡∏ä‡∏°.) ‡∏´‡πâ‡∏≤‡∏°‡∏ô‡∏≠‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á!', icon: 'Moon' },
      { start: '12:00', end: '13:00', task: '‡∏ï‡∏∑‡πà‡∏ô‡∏°‡∏≤‡∏≠‡∏≤‡∏ö‡∏ô‡πâ‡∏≥ / ‡∏Å‡∏¥‡∏ô‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á (‡∏°‡∏∑‡πâ‡∏≠‡πÉ‡∏´‡∏ç‡πà)', icon: 'Utensils' },
      { start: '13:00', end: '16:30', task: '‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡∏≠‡∏¥‡∏™‡∏£‡∏∞ / ‡πÅ‡∏ü‡∏ô', icon: 'Heart' },
      { start: '16:30', end: '18:30', task: 'Long Run (‡∏ã‡πâ‡∏≠‡∏°‡∏°‡∏≤‡∏£‡∏≤‡∏ò‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏•‡πâ‡∏≤ ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏´‡∏•‡∏±‡∏ö)', icon: 'Zap' },
      { start: '18:30', end: '20:00', task: '‡∏≠‡∏≤‡∏ö‡∏ô‡πâ‡∏≥ / ‡∏Å‡∏¥‡∏ô‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏¢‡πá‡∏ô‡∏Å‡∏±‡∏ö‡πÅ‡∏ü‡∏ô (‡∏°‡∏∑‡πâ‡∏≠‡πÉ‡∏´‡∏ç‡πà)', icon: 'Utensils' },
      { start: '20:00', end: '22:00', task: '‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡∏Å‡∏±‡∏ö‡πÅ‡∏ü‡∏ô ‡∏£‡∏≠‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏¢‡πà‡∏≠‡∏¢', icon: 'Heart' },
      { start: '22:00', end: '08:30', task: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏ô‡∏≠‡∏ô Reset ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢', icon: 'Moon' },
    ]
  },
  {
    id: 6, title: '‡∏ß‡∏±‡∏ô OFF 2-3 (Day 11-12) - ‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå', type: 'off_day_heaven', days: [11, 12],
    color: 'bg-purple-50 border-purple-200 text-purple-800', accent: 'bg-purple-500',
    routine: [
      { start: '08:30', end: '09:30', task: '‡∏ï‡∏∑‡πà‡∏ô‡∏ô‡∏≠‡∏ô (Recovery 10 ‡∏ä‡∏°.) / ‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ä‡πâ‡∏≤‡πÄ‡∏ö‡∏≤‡πÜ', icon: 'Coffee' },
      { start: '09:30', end: '11:30', task: '‡∏¢‡∏¥‡∏° (Weight Training)', icon: 'Dumbbell' },
      { start: '12:00', end: '13:00', task: '‡∏Å‡∏¥‡∏ô‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á (‡∏°‡∏∑‡πâ‡∏≠‡πÉ‡∏´‡∏ç‡πà)', icon: 'Utensils' },
      { start: '13:00', end: '18:00', task: '[‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏¥‡∏™‡∏£‡∏∞/Coding/Docker]', icon: 'Code' },
      { start: '18:00', end: '19:30', task: '‡∏Å‡∏¥‡∏ô‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏¢‡πá‡∏ô‡∏Å‡∏±‡∏ö‡πÅ‡∏ü‡∏ô (‡∏°‡∏∑‡πâ‡∏≠‡πÉ‡∏´‡∏ç‡πà)', icon: 'Heart' },
      { start: '19:30', end: '22:15', task: '‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡∏¢‡∏≤‡∏ß‡πÜ', icon: 'Sun' },
      { start: '22:15', end: '05:45', task: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏ô‡∏≠‡∏ô (‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏∑‡πà‡∏ô‡πÄ‡∏ä‡πâ‡∏≤‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ)', icon: 'Moon' },
    ]
  }
];

const thaiHolidays = {
  "2024-12-05": "‡∏ß‡∏±‡∏ô‡∏û‡πà‡∏≠‡πÅ‡∏´‡πà‡∏á‡∏ä‡∏≤‡∏ï‡∏¥", "2024-12-10": "‡∏ß‡∏±‡∏ô‡∏£‡∏±‡∏ê‡∏ò‡∏£‡∏£‡∏°‡∏ô‡∏π‡∏ç", "2024-12-31": "‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏õ‡∏µ",
  "2025-01-01": "‡∏ß‡∏±‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà", "2025-02-12": "‡∏ß‡∏±‡∏ô‡∏°‡∏≤‡∏Ü‡∏ö‡∏π‡∏ä‡∏≤", "2025-04-06": "‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏Å‡∏£‡∏µ",
  "2025-04-13": "‡∏ß‡∏±‡∏ô‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå", "2025-04-14": "‡∏ß‡∏±‡∏ô‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå", "2025-04-15": "‡∏ß‡∏±‡∏ô‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå",
};

const App = () => {
  // --- ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (State Management) ---

  // ‡∏î‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏ö‡∏à‡∏≤‡∏Å LocalStorage
  const [startDateStr, setStartDateStr] = useState(() => {
    return localStorage.getItem('hybrid_engineer_start_date') || '2024-11-25';
  });

  // ‡∏î‡∏∂‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏à‡∏≤‡∏Å LocalStorage ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
  const [scheduleData, setScheduleData] = useState(() => {
    const saved = localStorage.getItem('hybrid_engineer_schedule_json');
    if (saved) {
      try { return JSON.parse(saved); } catch (e) { return INITIAL_SCHEDULE; }
    }
    return INITIAL_SCHEDULE;
  });

  const [now, setNow] = useState(new Date()); 
  const [view, setView] = useState('dashboard'); 
  const [calDate, setCalDate] = useState(new Date()); 
  const [previewOffset, setPreviewOffset] = useState(0); 
  const fileInputRef = useRef(null);

  // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏∏‡∏Å‡∏ô‡∏≤‡∏ó‡∏µ
  useEffect(() => {
    const timer = setInterval(() => setNow(new Date()), 1000); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏∏‡∏Å‡∏ß‡∏¥ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πá‡∏°‡∏ô‡∏≤‡∏ó‡∏µ‡πÄ‡∏î‡∏¥‡∏ô‡∏™‡∏ß‡∏¢‡πÜ
    return () => clearInterval(timer);
  }, []);

  // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏•‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
  useEffect(() => {
    localStorage.setItem('hybrid_engineer_start_date', startDateStr);
  }, [startDateStr]);

  // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
  useEffect(() => {
    localStorage.setItem('hybrid_engineer_schedule_json', JSON.stringify(scheduleData));
  }, [scheduleData]);

  // --- ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≠‡∏ö‡∏ß‡∏±‡∏ô (Business Logic) ---

  const totalCycleDays = useMemo(() => {
    let maxDay = 0;
    scheduleData.forEach(phase => {
      phase.days.forEach(d => { if (d > maxDay) maxDay = d; });
    });
    return maxDay || 1;
  }, [scheduleData]);

  const getCycleDayForDate = (targetDate) => {
    const start = new Date(startDateStr);
    start.setHours(0,0,0,0);
    const target = new Date(targetDate);
    target.setHours(0,0,0,0);
    const diffTime = target.getTime() - start.getTime();
    const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
    return ((diffDays % totalCycleDays + totalCycleDays) % totalCycleDays) + 1;
  };

  const displayInfo = useMemo(() => {
    const targetDate = new Date(now);
    targetDate.setDate(targetDate.getDate() + previewOffset);
    
    const d = getCycleDayForDate(targetDate);
    const p = scheduleData.find(phase => phase.days.includes(d));
    
    let currentTask = null;
    let nextTask = null;
    const timeStr = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');

    if (p && previewOffset === 0) {
      const sorted = [...p.routine].sort((a,b) => a.start.localeCompare(b.start));
      for (let i=0; i<sorted.length; i++) {
        const item = sorted[i];
        const nxt = sorted[i+1] || sorted[0];
        const isActive = (timeStr >= item.start && (timeStr < item.end || item.end < item.start)) || 
                         (item.end < item.start && timeStr < item.end);
        if (isActive) { currentTask = item; nextTask = nxt; break; }
      }
      if (!currentTask) { currentTask = sorted[0]; nextTask = sorted[1]; }
    }

    return { 
      cycleDay: d, 
      phase: p, 
      currentTask, 
      nextTask,
      targetDateLabel: targetDate.toLocaleDateString('th-TH', { day: 'numeric', month: 'long', year: 'numeric' }),
      isToday: previewOffset === 0
    };
  }, [now, startDateStr, scheduleData, previewOffset, totalCycleDays]);

  const calendarDays = useMemo(() => {
    const year = calDate.getFullYear();
    const month = calDate.getMonth();
    const days = [];
    const firstDay = new Date(year, month, 1).getDay();
    const total = new Date(year, month + 1, 0).getDate();

    for (let i = 0; i < firstDay; i++) days.push(null);
    for (let d = 1; d <= total; d++) {
      const date = new Date(year, month, d);
      const key = date.toISOString().split('T')[0];
      const cDay = getCycleDayForDate(date);
      days.push({
        dayNum: d, key, cDay, 
        phase: scheduleData.find(p => p.days.includes(cDay)),
        isWeekend: date.getDay() === 0 || date.getDay() === 6,
        holiday: thaiHolidays[key],
        isToday: new Date().toISOString().split('T')[0] === key
      });
    }
    return days;
  }, [calDate, startDateStr, scheduleData, totalCycleDays]);

  // --- Handlers ---
  const handleExport = () => {
    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(scheduleData, null, 2));
    const a = document.createElement('a');
    a.href = dataStr;
    a.download = "hybrid_engineer_schedule.json";
    a.click();
  };

  const handleImport = (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (ev) => {
      try {
        const json = JSON.parse(ev.target.result);
        setScheduleData(json);
        setView('dashboard');
      } catch (err) { alert("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"); }
    };
    reader.readAsText(file);
  };

  return (
    <div className="min-h-screen bg-slate-50 p-4 md:p-8 font-sans text-slate-900 pb-20">
      <div className="max-w-4xl mx-auto space-y-6">
        
        {/* Navigation Bar */}
        <header className="flex flex-col md:flex-row md:items-center justify-between gap-4 bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
          <div className="flex items-center gap-3 cursor-pointer" onClick={() => { setView('dashboard'); setPreviewOffset(0); }}>
             <div className="p-3 bg-yellow-500 rounded-2xl text-white shadow-lg">
                <Zap size={24} fill="white"/>
             </div>
             <div>
                <h1 className="text-xl font-bold tracking-tight">Hybrid Planner</h1>
                <p className="text-[10px] text-slate-400 font-black uppercase tracking-widest">Efficiency Edition</p>
             </div>
          </div>
          
          <div className="flex bg-slate-100 p-1.5 rounded-2xl overflow-x-auto">
            <button onClick={() => { setView('dashboard'); setPreviewOffset(0); }} className={`px-5 py-2 rounded-xl text-xs font-bold transition-all whitespace-nowrap ${view === 'dashboard' ? 'bg-white shadow-sm text-blue-600' : 'text-slate-500'}`}><Clock size={14} className="inline mr-2"/> Dashboard</button>
            <button onClick={() => setView('calendar')} className={`px-5 py-2 rounded-xl text-xs font-bold transition-all whitespace-nowrap ${view === 'calendar' ? 'bg-white shadow-sm text-blue-600' : 'text-slate-500'}`}><CalendarIcon size={14} className="inline mr-2"/> Calendar</button>
            <button onClick={() => setView('editor')} className={`px-5 py-2 rounded-xl text-xs font-bold transition-all whitespace-nowrap ${view === 'editor' ? 'bg-white shadow-sm text-blue-600' : 'text-slate-500'}`}><Settings size={14} className="inline mr-2"/> Setup</button>
          </div>
        </header>

        {view === 'dashboard' && (
          <div className="space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
            
            {/* Status Card */}
            <div className={`p-1 rounded-3xl shadow-xl transition-colors duration-700 ${displayInfo.phase?.accent || 'bg-slate-200'}`}>
              <div className="bg-white rounded-[1.4rem] p-6 md:p-8 flex flex-col md:flex-row gap-8 items-center">
                <div className="flex-1 space-y-5 text-center md:text-left w-full">
                  <div className="flex items-center justify-between">
                    <div className="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-slate-100 text-slate-600 text-[10px] font-black uppercase tracking-widest">
                      <Clock size={14}/> Cycle Day {displayInfo.cycleDay} / {totalCycleDays}
                    </div>
                    <div className="text-xs font-bold text-slate-400 flex items-center gap-2">
                      <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div> 
                      {now.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit', second: '2-digit' })}
                    </div>
                  </div>

                  <div>
                    <h2 className="text-slate-400 font-bold text-xs mb-2 uppercase tracking-tight">
                      {displayInfo.isToday ? "‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥:" : `‡∏™‡πà‡∏≠‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤: ${displayInfo.targetDateLabel}`}
                    </h2>
                    <div className="text-2xl md:text-3xl font-black text-slate-800 flex items-center justify-center md:justify-start gap-4">
                      <div className="p-3 bg-slate-50 text-blue-500 rounded-2xl">
                        <RenderIcon name={displayInfo.currentTask?.icon || 'Zap'} size={28} />
                      </div>
                      <span className="leading-tight">{displayInfo.currentTask?.task || "‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡∏≠‡∏¥‡∏™‡∏£‡∏∞"}</span>
                    </div>
                  </div>

                  {displayInfo.isToday && displayInfo.nextTask && (
                    <div className="text-xs text-slate-500 font-bold bg-slate-50 px-4 py-2 rounded-xl inline-block border border-slate-100">
                      ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ: <span className="text-slate-800">{displayInfo.nextTask.task}</span> ({displayInfo.nextTask.start})
                    </div>
                  )}
                </div>
                
                {/* Progress Visual */}
                <div className="w-44 h-44 relative flex items-center justify-center bg-slate-50 rounded-full border-4 border-slate-100 overflow-hidden shrink-0 shadow-inner">
                    <div className={`absolute bottom-0 w-full transition-all duration-1000 ${displayInfo.phase?.accent || 'bg-blue-500'}`} style={{ height: `${(displayInfo.cycleDay/totalCycleDays)*100}%`, opacity: 0.15 }}></div>
                    <div className="z-10 text-center">
                      <span className="block text-6xl font-black text-slate-800 leading-none">{displayInfo.cycleDay}</span>
                      <span className="text-[10px] font-black uppercase text-slate-400 tracking-tighter mt-1 block">Day of {totalCycleDays}</span>
                    </div>
                </div>
              </div>
            </div>

            {/* Routine Timeline with Sneak Peek */}
            <div className="bg-white rounded-[2rem] border border-slate-100 overflow-hidden shadow-sm">
              <div className="p-6 border-b border-slate-50 flex items-center justify-between flex-wrap gap-4">
                <div>
                  <h3 className="font-bold text-slate-800 text-lg">{displayInfo.phase?.title}</h3>
                  <p className="text-[10px] font-bold text-blue-500 uppercase tracking-widest">{displayInfo.targetDateLabel}</p>
                </div>
                <div className="flex bg-slate-50 p-1.5 rounded-2xl border border-slate-100">
                  <button onClick={() => setPreviewOffset(prev => prev - 1)} className="p-2 hover:bg-white hover:shadow-sm rounded-xl text-slate-400 transition-all active:scale-90"><ChevronLeft size={20}/></button>
                  <button onClick={() => setPreviewOffset(0)} className={`px-4 py-1 rounded-xl text-[10px] font-black uppercase transition-all ${previewOffset === 0 ? 'bg-blue-500 text-white shadow-md' : 'text-slate-400'}`}>Today</button>
                  <button onClick={() => setPreviewOffset(prev => prev + 1)} className="p-2 hover:bg-white hover:shadow-sm rounded-xl text-slate-400 transition-all active:scale-90"><ChevronRight size={20}/></button>
                </div>
              </div>

              <div className="divide-y divide-slate-50">
                {displayInfo.phase?.routine.map((item, idx) => {
                  const isActive = displayInfo.currentTask === item && displayInfo.isToday;
                  return (
                    <div key={idx} className={`flex items-center gap-5 p-5 transition-all ${isActive ? 'bg-blue-50/40' : 'hover:bg-slate-50/20'}`}>
                      <div className={`text-xs font-black w-24 shrink-0 ${isActive ? 'text-blue-600' : 'text-slate-400'}`}>{item.start} - {item.end}</div>
                      <div className={`p-2.5 rounded-xl shrink-0 ${isActive ? 'bg-blue-100 text-blue-600' : 'bg-slate-100 text-slate-400'}`}><RenderIcon name={item.icon} size={18} /></div>
                      <div className={`flex-1 text-sm ${isActive ? 'font-black text-slate-800' : 'font-medium text-slate-600'}`}>{item.task}</div>
                    </div>
                  );
                })}
              </div>
            </div>

            {/* Quick Config */}
            <div className="bg-white p-6 rounded-3xl border border-slate-100 flex flex-col md:flex-row md:items-center justify-between gap-4 shadow-sm">
              <div className="flex items-center gap-4">
                <div className="p-3 bg-blue-50 text-blue-500 rounded-2xl"><CalendarIcon size={20}/></div>
                <div>
                  <div className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Cycle Start Date</div>
                  <input type="date" value={startDateStr} onChange={(e) => setStartDateStr(e.target.value)} className="font-bold text-slate-700 outline-none cursor-pointer hover:text-blue-600 transition-colors"/>
                </div>
              </div>
              <p className="text-[10px] text-slate-400 font-bold max-w-[200px] leading-relaxed md:text-right italic">*‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏∞‡πÄ‡∏ä‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏à‡∏≥‡∏Ñ‡πà‡∏≤‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ‡∏ï‡∏•‡∏≠‡∏î‡πÑ‡∏õ</p>
            </div>
          </div>
        )}

        {view === 'calendar' && (
          <div className="space-y-6 animate-in fade-in zoom-in-95 duration-500">
            <div className="bg-white p-5 rounded-3xl shadow-sm border border-slate-100 flex items-center justify-between">
               <button onClick={() => setCalDate(new Date(calDate.getFullYear(), calDate.getMonth() - 1, 1))} className="p-2 hover:bg-slate-100 rounded-xl transition-all"><ChevronLeft size={24}/></button>
               <h2 className="text-xl font-black text-slate-800 uppercase">{calDate.toLocaleDateString('th-TH', { month: 'long', year: 'numeric' })}</h2>
               <button onClick={() => setCalDate(new Date(calDate.getFullYear(), calDate.getMonth() + 1, 1))} className="p-2 hover:bg-slate-100 rounded-xl transition-all"><ChevronRight size={24}/></button>
            </div>

            <div className="grid grid-cols-7 gap-3">
               {['‡∏≠‡∏≤', '‡∏à', '‡∏≠', '‡∏û', '‡∏û‡∏§', '‡∏®', '‡∏™'].map(d => <div key={d} className="text-center text-[10px] font-black text-slate-400 py-2 uppercase">{d}</div>)}
               {calendarDays.map((day, idx) => {
                 if (!day) return <div key={`empty-${idx}`} className="aspect-square opacity-20"></div>;
                 const isOffMatch = day.phase?.type.includes('off') && (day.isWeekend || day.holiday);
                 const isGhostDay = day.cDay === 7;
                 
                 return (
                   <div key={day.key} onClick={() => {
                      const today = new Date(); today.setHours(0,0,0,0);
                      const target = new Date(day.key);
                      const diffDays = Math.floor((target.getTime() - today.getTime()) / (1000 * 60 * 60 * 24));
                      setPreviewOffset(diffDays); setView('dashboard');
                   }} className={`aspect-square relative flex flex-col items-center justify-center rounded-2xl border-2 cursor-pointer transition-all hover:scale-105 active:scale-95
                      ${day.phase?.color || 'bg-white border-slate-100'} 
                      ${day.isToday ? 'border-blue-500 ring-4 ring-blue-50 z-10' : 'border-transparent'}
                      ${isOffMatch ? 'ring-2 ring-rose-400 shadow-lg' : ''}
                   `}>
                      <span className={`text-sm font-black ${day.isWeekend ? 'text-rose-500' : 'text-slate-700'}`}>{day.dayNum}</span>
                      <span className="text-[8px] font-bold opacity-30">D{day.cDay}</span>
                      
                      {/* ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ç‡∏ô‡∏≤‡∏î EMOJI ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏Ç‡∏≠ */}
                      <div className="absolute top-1 right-1 flex flex-col gap-0.5">
                        {isGhostDay && <span className="text-lg leading-none" title="‡∏£‡∏≠‡∏¢‡∏ï‡πà‡∏≠‡∏Å‡∏∞‡∏î‡∏∂‡∏Å (‡∏á‡∏µ‡∏ö‡∏î‡πà‡∏ß‡∏ô!)">üëª</span>}
                        {day.holiday && <span className="text-[8px] bg-rose-500 text-white px-1 rounded-full">{day.holiday.substring(0,3)}</span>}
                      </div>
                      
                      <div className="absolute bottom-1">
                        {isOffMatch && <span className="text-xl leading-none">‚ù§Ô∏è</span>}
                      </div>
                   </div>
                 );
               })}
            </div>
            
            <div className="bg-white p-6 rounded-[2rem] border border-slate-100 flex items-center justify-center gap-8 shadow-sm">
                <div className="flex items-center gap-2"><span className="text-xl">üëª</span> <span className="text-[10px] font-black text-slate-400 uppercase">Ghost Nap Transition</span></div>
                <div className="flex items-center gap-2"><span className="text-xl">‚ù§Ô∏è</span> <span className="text-[10px] font-black text-slate-400 uppercase">Perfect OFF Match</span></div>
            </div>
          </div>
        )}

        {view === 'editor' && (
          <div className="space-y-6 animate-in fade-in slide-in-from-right-4 duration-500 pb-10">
            <div className="bg-white p-6 rounded-3xl border border-slate-100 flex flex-col md:flex-row justify-between items-center gap-4">
              <h2 className="text-xl font-black text-slate-800">Advanced Schedule Editor</h2>
              <div className="flex gap-2">
                <button onClick={handleExport} className="px-4 py-2 bg-slate-100 hover:bg-slate-200 rounded-xl text-xs font-bold transition-all flex items-center gap-2"><Download size={14}/> Export</button>
                <button onClick={() => fileInputRef.current?.click()} className="px-4 py-2 bg-slate-100 hover:bg-slate-200 rounded-xl text-xs font-bold transition-all flex items-center gap-2"><Upload size={14}/> Import</button>
                <input type="file" ref={fileInputRef} className="hidden" accept=".json" onChange={handleImport} />
              </div>
            </div>

            <div className="space-y-6">
              {scheduleData.map((phase) => (
                <div key={phase.id} className="bg-white rounded-[2rem] border border-slate-100 shadow-sm overflow-hidden">
                  <div className={`p-1.5 ${phase.accent}`}></div>
                  <div className="p-6">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                       <input value={phase.title} onChange={(e) => setScheduleData(prev => prev.map(p => p.id === phase.id ? {...p, title: e.target.value} : p))} className="text-lg font-black text-slate-800 border-b-2 border-slate-50 focus:border-blue-300 outline-none" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏∞"/>
                       <input value={phase.days.join(',')} onChange={(e) => setScheduleData(prev => prev.map(p => p.id === phase.id ? {...p, days: e.target.value.split(',').map(n => parseInt(n)).filter(n => !isNaN(n))} : p))} className="font-bold text-slate-500 border-b-2 border-slate-50 focus:border-blue-300 outline-none" placeholder="‡πÄ‡∏•‡∏Ç‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ô‡∏£‡∏≠‡∏ö (‡πÄ‡∏ä‡πà‡∏ô 1,2,3)"/>
                    </div>
                    
                    <div className="space-y-2">
                      {phase.routine.map((item, idx) => (
                        <div key={idx} className="flex gap-2 bg-slate-50 p-3 rounded-2xl group">
                           <input value={item.start} onChange={(e) => setScheduleData(prev => prev.map(p => p.id === phase.id ? {...p, routine: p.routine.map((r, i) => i === idx ? {...r, start: e.target.value} : r)} : p))} className="w-16 text-[10px] font-black bg-white px-2 py-1 rounded-lg border border-slate-100 outline-none"/>
                           <input value={item.task} onChange={(e) => setScheduleData(prev => prev.map(p => p.id === phase.id ? {...p, routine: p.routine.map((r, i) => i === idx ? {...r, task: e.target.value} : r)} : p))} className="flex-1 text-xs font-bold bg-white px-3 py-1 rounded-lg border border-slate-100 outline-none"/>
                           <button onClick={() => setScheduleData(prev => prev.map(p => p.id === phase.id ? {...p, routine: p.routine.filter((_, i) => i !== idx)} : p))} className="text-rose-400 opacity-0 group-hover:opacity-100 transition-opacity"><Trash2 size={16}/></button>
                        </div>
                      ))}
                      <button onClick={() => setScheduleData(prev => prev.map(p => p.id === phase.id ? {...p, routine: [...p.routine, {start: '09:00', end: '10:00', task: '‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà', icon: 'Clock'}]} : p))} className="w-full py-2 border-2 border-dashed border-slate-100 rounded-2xl text-[10px] font-black text-slate-400 hover:bg-slate-50 transition-all uppercase mt-2">+ Add Activity</button>
                    </div>
                  </div>
                </div>
              ))}
              
              <button onClick={() => setScheduleData(prev => [...prev, {id: Date.now(), title: 'Phase ‡πÉ‡∏´‡∏°‡πà', days: [], accent: 'bg-blue-500', color: 'bg-blue-50', routine: []}])} className="w-full p-6 border-2 border-dashed border-slate-200 rounded-[2rem] text-slate-400 font-black hover:border-blue-200 hover:text-blue-500 transition-all uppercase">+ Create New Phase</button>
              
              <div className="p-8 bg-blue-600 rounded-[2rem] text-white shadow-xl shadow-blue-100">
                <h3 className="text-xl font-black mb-2 flex items-center gap-2"><Save size={20}/> Save & Preview</h3>
                <p className="text-xs opacity-80 mb-6 leading-relaxed">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏•‡∏á‡πÉ‡∏ô Browser ‡∏ô‡∏µ‡πâ ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ Export ‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏£‡∏≠‡∏á‡πÑ‡∏î‡πâ</p>
                <button onClick={() => { setView('dashboard'); window.scrollTo(0,0); }} className="w-full bg-white text-blue-600 py-4 rounded-2xl font-black shadow-lg hover:bg-blue-50 transition-all active:scale-95 uppercase tracking-widest">Done! Return to Dashboard</button>
              </div>
            </div>
          </div>
        )}

        <footer className="text-center pb-8 opacity-40">
           <p className="text-[9px] font-black uppercase tracking-[0.2em] mb-1">Dynamic Hybrid System ‚Ä¢ Revision 2.5</p>
           <p className="text-[8px] font-medium">Efficiency is the only freedom for Engineers</p>
        </footer>
      </div>
    </div>
  );
};

export default App;
