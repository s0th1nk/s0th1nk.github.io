<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Hybrid Engineer - Performance Dashboard</title>
    <!-- ‡πÉ‡∏ä‡πâ Tailwind CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Layout ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ‡πÉ‡∏ä‡πâ‡∏ü‡∏≠‡∏ô‡∏ï‡πå Noto Sans Thai ‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏ó‡∏±‡∏ô‡∏™‡∏°‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans Thai', sans-serif; }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* ‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô Progress ‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏™‡∏°‡∏π‡∏ó */
        .progress-bar { transition: height 1s cubic-bezier(0.4, 0, 0.2, 1); }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 pb-20">

    <div class="max-w-4xl mx-auto p-4 md:p-8 space-y-6">
        <!-- ==========================================
             ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß (Header & Navigation)
             ========================================== -->
        <header class="flex flex-col md:flex-row md:items-center justify-between gap-4 bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
            <div class="flex items-center gap-3 cursor-pointer" onclick="goToDashboard()">
                <div class="p-3 bg-yellow-500 rounded-2xl text-white shadow-lg">
                    <svg xmlns="http://www.w3.org/2001/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
                </div>
                <div>
                    <h1 class="text-xl font-black tracking-tight leading-none">Hybrid Planner</h1>
                    <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest mt-1">Lazy Morning Edition</p>
                </div>
            </div>
            
            <div class="flex bg-slate-100 p-1.5 rounded-2xl overflow-x-auto gap-1">
                <button onclick="changeView('dashboard')" id="nav-dashboard" class="nav-item px-5 py-2 rounded-xl text-xs font-bold transition-all whitespace-nowrap bg-white shadow-sm text-blue-600">Dashboard</button>
                <button onclick="changeView('calendar')" id="nav-calendar" class="nav-item px-5 py-2 rounded-xl text-xs font-bold transition-all whitespace-nowrap text-slate-500">Calendar</button>
                <button onclick="changeView('editor')" id="nav-editor" class="nav-item px-5 py-2 rounded-xl text-xs font-bold transition-all whitespace-nowrap text-slate-500">Setup</button>
            </div>
        </header>

        <!-- ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤ -->
        <main id="app-content" class="fade-in"></main>

        <footer class="text-center opacity-30 mt-10">
            <p class="text-[9px] font-black uppercase tracking-[0.2em]">Efficiency is the only freedom for Hybrid Engineers</p>
        </footer>
    </div>

    <!-- ==========================================
         JAVASCRIPT (Vanilla JS)
         ========================================== -->
    <script>
        /**
         * 1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô (INITIAL DATA)
         * ‡∏£‡∏ß‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏à‡∏≤‡∏Å Revision 1
         */
        const DEFAULT_SCHEDULE = [
            {
                id: 1, title: '‡∏Å‡∏∞‡πÄ‡∏ä‡πâ‡∏≤ (Day 1-3) - ‡∏ß‡∏¥‡∏ô‡∏±‡∏¢‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠', type: 'morning_shift', days: [1, 2, 3],
                color: 'bg-yellow-50 border-yellow-200 text-yellow-800', accent: 'bg-yellow-500',
                routine: [
                    { start: '05:45', end: '06:15', task: '‡∏ï‡∏∑‡πà‡∏ô / ‡∏≠‡∏≤‡∏ö‡∏ô‡πâ‡∏≥ / ‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡∏ß (‡πÉ‡∏ä‡πâ Willpower ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)', icon: 'Zap' },
                    { start: '06:15', end: '06:30', task: '‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á (15 ‡∏ô‡∏≤‡∏ó‡∏µ)', icon: 'MapPin' },
                    { start: '06:30', end: '07:00', task: '‡∏ñ‡∏∂‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô / ‡∏£‡∏±‡∏ö‡πÄ‡∏ß‡∏£ / ‡∏î‡∏∑‡πà‡∏° Protein Shake', icon: 'Coffee' },
                    { start: '07:00', end: '15:00', task: '‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡∏∞‡πÄ‡∏ä‡πâ‡∏≤ (‡∏û‡∏±‡∏Å‡∏Å‡∏¥‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á 1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)', icon: 'Code' },
                    { start: '15:00', end: '15:15', task: '‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏¢‡∏¥‡∏° (15 ‡∏ô‡∏≤‡∏ó‡∏µ)', icon: 'MapPin' },
                    { start: '15:15', end: '17:15', task: '‡∏¢‡∏¥‡∏° (Weight Training) - ‡∏ó‡πà‡∏≤ Compound', icon: 'Dumbbell' },
                    { start: '17:15', end: '17:45', task: '‡∏≠‡∏≤‡∏ö‡∏ô‡πâ‡∏≥‡∏ó‡∏µ‡πà‡∏¢‡∏¥‡∏° (‡∏•‡∏î‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡πâ‡∏≤‡∏ô)', icon: 'Bath' },
                    { start: '17:45', end: '18:00', task: '‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô', icon: 'MapPin' },
                    { start: '18:00', end: '19:00', task: '‡∏Å‡∏¥‡∏ô‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏¢‡πá‡∏ô (‡∏°‡∏∑‡πâ‡∏≠‡πÉ‡∏´‡∏ç‡πà) - ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡πà‡∏°', icon: 'Utensils' },
                    { start: '19:00', end: '22:15', task: '[‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏±‡∏Å/Coding] ‡∏ó‡πâ‡∏≠‡∏á‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡πà‡∏≠‡∏¢ ‡∏´‡πâ‡∏≤‡∏°‡∏ô‡∏≠‡∏ô‡∏£‡∏≤‡∏ö!', icon: 'Code' },
                    { start: '22:15', end: '05:45', task: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏ô‡∏≠‡∏ô (‡∏ô‡∏≠‡∏ô 7.5 ‡∏ä‡∏°.)', icon: 'Moon' }
                ]
            },
            {
                id: 2, title: '‡∏Å‡∏∞‡∏ö‡πà‡∏≤‡∏¢ (Day 4-6) - ‡∏ï‡∏∑‡πà‡∏ô‡∏™‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö‡∏°‡∏µ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û', type: 'afternoon_shift', days: [4, 5, 6],
                color: 'bg-orange-50 border-orange-200 text-orange-800', accent: 'bg-orange-500',
                routine: [
                    { start: '09:30', end: '10:15', task: '‡∏ï‡∏∑‡πà‡∏ô‡∏ô‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö Lazy Morning / ‡∏à‡∏¥‡∏ö‡∏Å‡∏≤‡πÅ‡∏ü / ‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô', icon: 'Coffee' },
                    { start: '10:15', end: '10:30', task: '‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏¢‡∏¥‡∏°', icon: 'MapPin' },
                    { start: '10:30', end: '12:30', task: '‡∏¢‡∏¥‡∏° (Weight Training)', icon: 'Dumbbell' },
                    { start: '12:30', end: '13:00', task: '‡∏≠‡∏≤‡∏ö‡∏ô‡πâ‡∏≥‡∏ó‡∏µ‡πà‡∏¢‡∏¥‡∏°', icon: 'Bath' },
                    { start: '13:00', end: '14:15', task: '‡∏Å‡∏¥‡∏ô‡∏°‡∏∑‡πâ‡∏≠‡πÉ‡∏´‡∏ç‡πà (‡∏°‡∏∑‡πâ‡∏≠‡∏´‡∏•‡∏±‡∏Å) - ‡πÄ‡∏ô‡πâ‡∏ô‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô/‡∏Ñ‡∏≤‡∏£‡πå‡∏ö', icon: 'Utensils' },
                    { start: '14:15', end: '14:30', task: '‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (15 ‡∏ô‡∏≤‡∏ó‡∏µ)', icon: 'MapPin' },
                    { start: '15:00', end: '23:00', task: '‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡∏∞‡∏ö‡πà‡∏≤‡∏¢ (‡∏°‡∏∑‡πâ‡∏≠‡∏£‡∏≠‡∏á 19:00 ‡πÅ‡∏ã‡∏ô‡∏ß‡∏¥‡∏ä/‡∏ú‡∏•‡πÑ‡∏°‡πâ)', icon: 'Code' },
                    { start: '23:00', end: '23:15', task: '‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô', icon: 'MapPin' },
                    { start: '23:15', end: '00:00', task: '‡∏≠‡∏≤‡∏ö‡∏ô‡πâ‡∏≥ / ‡∏°‡∏∑‡πâ‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏≠‡∏ô (‡πÄ‡∏ö‡∏≤‡∏°‡∏≤‡∏Å ‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡∏°‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô)', icon: 'Utensils' },
                    { start: '00:00', end: '02:00', task: '[‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏±‡∏Å/Coding] Deep Work ‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡∏™‡∏á‡∏ö', icon: 'Code' },
                    { start: '02:00', end: '09:30', task: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏ô‡∏≠‡∏ô (‡∏ï‡∏∑‡πà‡∏ô 09:30)', icon: 'Moon' }
                ]
            },
            {
                id: 3, title: '‡∏£‡∏≠‡∏¢‡∏ï‡πà‡∏≠‡∏ö‡πà‡∏≤‡∏¢‡πÑ‡∏õ‡∏î‡∏∂‡∏Å (Day 7) - ‡∏á‡∏µ‡∏ö‡∏õ‡∏π‡∏û‡∏∑‡πâ‡∏ô', type: 'transition', days: [7],
                color: 'bg-blue-50 border-blue-200 text-blue-800', accent: 'bg-blue-500',
                routine: [
                    { start: '10:00', end: '11:00', task: '‡∏ï‡∏∑‡πà‡∏ô‡∏ô‡∏≠‡∏ô / ‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡∏ï‡∏≤‡∏°‡∏≠‡∏±‡∏ò‡∏¢‡∏≤‡∏®‡∏±‡∏¢', icon: 'Sun' },
                    { start: '11:00', end: '12:30', task: '‡∏ß‡∏¥‡πà‡∏á Easy Run (‡πÇ‡∏ã‡∏ô 2) - ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ñ‡πâ‡∏ô‡πÅ‡∏£‡∏á', icon: 'Zap' },
                    { start: '12:30', end: '13:30', task: '‡∏≠‡∏≤‡∏ö‡∏ô‡πâ‡∏≥ / ‡∏Å‡∏¥‡∏ô‡∏°‡∏∑‡πâ‡∏≠‡πÉ‡∏´‡∏ç‡πà', icon: 'Bath' },
                    { start: '13:30', end: '15:00', task: '[‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô/Coding]', icon: 'Code' },
                    { start: '15:00', end: '18:00', task: '‡∏ô‡∏≠‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô (Nap 3 ‡∏ä‡∏°.) - ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πâ‡∏≤‡∏Å‡∏∞‡∏î‡∏∂‡∏Å', icon: 'Ghost' },
                    { start: '18:00', end: '19:00', task: '‡∏ï‡∏∑‡πà‡∏ô‡∏°‡∏≤‡∏≠‡∏≤‡∏ö‡∏ô‡πâ‡∏≥ / ‡∏Å‡∏¥‡∏ô‡∏°‡∏∑‡πâ‡∏≠‡πÉ‡∏´‡∏ç‡πà (‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏¢‡πá‡∏ô)', icon: 'Utensils' },
                    { start: '19:00', end: '22:30', task: '[‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô/‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡πÅ‡∏ü‡∏ô] ‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡∏ï‡∏∑‡πà‡∏ô‡∏ï‡∏±‡∏ß', icon: 'Heart' },
                    { start: '23:00', end: '07:00', task: '‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡∏∞‡∏î‡∏∂‡∏Å‡∏Ñ‡∏∑‡∏ô‡∏ó‡∏µ‡πà 1 (‡∏°‡∏∑‡πâ‡∏≠‡∏î‡∏∂‡∏Å 01:00)', icon: 'Code' }
                ]
            },
            {
                id: 4, title: '‡∏Å‡∏∞‡∏î‡∏∂‡∏Å (Day 8-9) - ‡∏™‡∏π‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏á‡πà‡∏ß‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏ß‡∏¥‡πà‡∏á', type: 'night_shift', days: [8, 9],
                color: 'bg-indigo-50 border-indigo-200 text-indigo-800', accent: 'bg-indigo-500',
                routine: [
                    { start: '07:15', end: '08:00', task: '‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô / ‡∏Å‡∏¥‡∏ô‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ä‡πâ‡∏≤ (‡∏°‡∏∑‡πâ‡∏≠‡πÉ‡∏´‡∏ç‡πà)', icon: 'Utensils' },
                    { start: '08:00', end: '10:00', task: '[‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏±‡∏Å/Coding] ‡∏£‡∏≠‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏¢‡πà‡∏≠‡∏¢', icon: 'Code' },
                    { start: '10:00', end: '17:30', task: '‡∏ô‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏ö‡∏¢‡∏≤‡∏ß (‡∏°‡πà‡∏≤‡∏ô‡∏Å‡∏±‡∏ô‡πÅ‡∏™‡∏á 100%)', icon: 'Moon' },
                    { start: '17:30', end: '18:30', task: '‡∏ß‡∏¥‡πà‡∏á Tempo (30-45 ‡∏ô‡∏≤‡∏ó‡∏µ) - ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢', icon: 'Zap' },
                    { start: '18:30', end: '19:30', task: '‡∏≠‡∏≤‡∏ö‡∏ô‡πâ‡∏≥ / ‡∏Å‡∏¥‡∏ô‡∏°‡∏∑‡πâ‡∏≠‡πÉ‡∏´‡∏ç‡πà', icon: 'Bath' },
                    { start: '19:30', end: '22:30', task: '[‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏±‡∏Å/‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡πÅ‡∏ü‡∏ô/Coding]', icon: 'Heart' },
                    { start: '23:00', end: '07:00', task: '‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡∏∞‡∏î‡∏∂‡∏Å', icon: 'Code' }
                ]
            },
            {
                id: 10, title: '‡∏ß‡∏±‡∏ô OFF 1 (Day 10) - ‡∏Å‡∏π‡πâ‡∏ã‡∏≤‡∏Å‡πÅ‡∏•‡∏∞ Reset', type: 'off_day_1', days: [10],
                color: 'bg-emerald-50 border-emerald-200 text-emerald-800', accent: 'bg-emerald-500',
                routine: [
                    { start: '07:15', end: '08:00', task: '‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô / ‡∏Å‡∏¥‡∏ô‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ä‡πâ‡∏≤ (‡πÄ‡∏ö‡∏≤‡πÜ)', icon: 'Coffee' },
                    { start: '08:00', end: '12:00', task: 'Anchor Nap (4 ‡∏ä‡∏°.) - ‡∏´‡πâ‡∏≤‡∏°‡∏ô‡∏≠‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á!', icon: 'Moon' },
                    { start: '12:00', end: '13:00', task: '‡∏ï‡∏∑‡πà‡∏ô‡∏°‡∏≤‡∏≠‡∏≤‡∏ö‡∏ô‡πâ‡∏≥ / ‡∏Å‡∏¥‡∏ô‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á (‡∏°‡∏∑‡πâ‡∏≠‡πÉ‡∏´‡∏ç‡πà)', icon: 'Utensils' },
                    { start: '13:00', end: '16:30', task: '[‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡∏≠‡∏¥‡∏™‡∏£‡∏∞/‡πÅ‡∏ü‡∏ô]', icon: 'Heart' },
                    { start: '16:30', end: '18:30', task: 'Long Run (‡∏ã‡πâ‡∏≠‡∏°‡∏°‡∏≤‡∏£‡∏≤‡∏ò‡∏≠‡∏ô) - ‡∏ß‡∏¥‡πà‡∏á‡πÉ‡∏´‡πâ‡∏•‡πâ‡∏≤', icon: 'Zap' },
                    { start: '18:30', end: '20:00', task: '‡∏≠‡∏≤‡∏ö‡∏ô‡πâ‡∏≥ / ‡∏Å‡∏¥‡∏ô‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏¢‡πá‡∏ô‡∏Å‡∏±‡∏ö‡πÅ‡∏ü‡∏ô (‡∏°‡∏∑‡πâ‡∏≠‡πÉ‡∏´‡∏ç‡πà)', icon: 'Utensils' },
                    { start: '20:00', end: '22:00', task: '[‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡∏Å‡∏±‡∏ö‡πÅ‡∏ü‡∏ô] ‡∏Ñ‡∏∏‡∏¢/‡∏î‡∏π‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå ‡∏£‡∏≠‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏¢‡πà‡∏≠‡∏¢', icon: 'Heart' },
                    { start: '22:00', end: '08:30', task: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏ô‡∏≠‡∏ô (Reset ‡∏£‡∏∞‡∏ö‡∏ö)', icon: 'Moon' }
                ]
            },
            {
                id: 11, title: '‡∏ß‡∏±‡∏ô OFF 2-3 (Day 11-12) - ‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå Hybrid', type: 'off_day_heaven', days: [11, 12],
                color: 'bg-purple-50 border-purple-200 text-purple-800', accent: 'bg-purple-500',
                routine: [
                    { start: '08:30', end: '09:30', task: '‡∏ï‡∏∑‡πà‡∏ô‡∏ô‡∏≠‡∏ô (Recovery 10 ‡∏ä‡∏°.) / ‡∏Å‡∏¥‡∏ô‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ä‡πâ‡∏≤‡πÄ‡∏ö‡∏≤‡πÜ', icon: 'Coffee' },
                    { start: '09:30', end: '11:30', task: '‡∏¢‡∏¥‡∏° (Weight Training)', icon: 'Dumbbell' },
                    { start: '12:00', end: '13:00', task: '‡∏Å‡∏¥‡∏ô‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á (‡∏°‡∏∑‡πâ‡∏≠‡πÉ‡∏´‡∏ç‡πà)', icon: 'Utensils' },
                    { start: '13:00', end: '18:00', task: '[‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏¥‡∏™‡∏£‡∏∞/Coding/‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö Docker]', icon: 'Code' },
                    { start: '18:00', end: '19:30', task: '‡∏Å‡∏¥‡∏ô‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏¢‡πá‡∏ô‡∏Å‡∏±‡∏ö‡πÅ‡∏ü‡∏ô (‡∏°‡∏∑‡πâ‡∏≠‡πÉ‡∏´‡∏ç‡πà)', icon: 'Heart' },
                    { start: '19:30', end: '22:15', task: '[‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡∏¢‡∏≤‡∏ß‡πÜ]', icon: 'Sun' },
                    { start: '22:15', end: '05:45', task: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏ô‡∏≠‡∏ô (‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏∑‡πà‡∏ô 05:45 ‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ)', icon: 'Moon' }
                ]
            }
        ];

        const THAI_HOLIDAYS = {
            "2024-12-05": "‡∏ß‡∏±‡∏ô‡∏û‡πà‡∏≠‡πÅ‡∏´‡πà‡∏á‡∏ä‡∏≤‡∏ï‡∏¥", "2024-12-10": "‡∏ß‡∏±‡∏ô‡∏£‡∏±‡∏ê‡∏ò‡∏£‡∏£‡∏°‡∏ô‡∏π‡∏ç", "2024-12-31": "‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏õ‡∏µ",
            "2025-01-01": "‡∏ß‡∏±‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà", "2025-04-13": "‡∏ß‡∏±‡∏ô‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå", "2025-04-14": "‡∏ß‡∏±‡∏ô‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå", "2025-04-15": "‡∏ß‡∏±‡∏ô‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå"
        };

        /**
         * 2. ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (STATE)
         * ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å LocalStorage ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
         */
        let scheduleData = JSON.parse(localStorage.getItem('hybrid_schedule_v1')) || DEFAULT_SCHEDULE;
        let startDateStr = localStorage.getItem('hybrid_start_date') || '2024-11-25';
        let currentView = 'dashboard';
        let previewOffset = 0; // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏î‡∏π‡∏ß‡∏±‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ/‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
        let calendarBaseDate = new Date(); // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ï‡πà‡∏≤‡∏á‡πÜ

        /**
         * 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≠‡∏ö‡∏ß‡∏±‡∏ô (CORE CALCULATIONS)
         */

        // ‡∏´‡∏≤‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô 1 ‡∏£‡∏≠‡∏ö (Cycle Length)
        function getCycleLength() {
            let max = 0;
            scheduleData.forEach(p => p.days.forEach(d => { if(d > max) max = d; }));
            return max || 1;
        }

        // ‡∏´‡∏≤‡∏ß‡πà‡∏≤ "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î" ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡πÑ‡∏´‡∏ô‡πÉ‡∏ô‡∏£‡∏≠‡∏ö Cycle (Day 1 - Day X)
        function getCycleDay(dateObj) {
            const start = new Date(startDateStr);
            start.setHours(0,0,0,0);
            const target = new Date(dateObj);
            target.setHours(0,0,0,0);
            
            const diffTime = target.getTime() - start.getTime();
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            const cycleLen = getCycleLength();
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏ö‡∏ö Modulo ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ß‡∏ô‡∏£‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î
            return ((diffDays % cycleLen + cycleLen) % cycleLen) + 1;
        }

        // ‡∏î‡∏∂‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° Icon ‡πÅ‡∏ö‡∏ö SVG
        function getIcon(name) {
            const icons = {
                Zap: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>',
                Coffee: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8h1a4 4 0 0 1 0 8h-1"/><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/></svg>',
                Code: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>',
                Dumbbell: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M6 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/><path d="M18 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/><path d="M14 12H10"/><path d="M22 10v4"/><path d="M2 10v4"/></svg>',
                Utensils: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></svg>',
                Moon: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>',
                MapPin: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>',
                Bath: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M10 2v3"/><path d="M14 2v3"/><path d="M18 2v3"/><path d="M22 11a10 10 0 0 1-10 10c-5.5 0-10-4.5-10-10a10 10 0 0 1 10-10h.5"/></svg>',
                Heart: '<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" stroke="none" class="text-rose-500"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>',
                Sun: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>'
            };
            return icons[name] || icons.Sun;
        }

        /**
         * 4. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• (RENDER)
         */

        function changeView(view) {
            currentView = view;
            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.remove('bg-white', 'shadow-sm', 'text-blue-600');
                el.classList.add('text-slate-500');
            });
            document.getElementById('nav-' + view).classList.add('bg-white', 'shadow-sm', 'text-blue-600');
            document.getElementById('nav-' + view).classList.remove('text-slate-500');
            render();
        }

        function render() {
            const container = document.getElementById('app-content');
            container.innerHTML = '';

            if (currentView === 'dashboard') renderDashboard(container);
            else if (currentView === 'calendar') renderCalendar(container);
            else if (currentView === 'editor') renderEditor(container);
        }

        // ‡∏´‡∏ô‡πâ‡∏≤ DASHBOARD
        function renderDashboard(container) {
            const now = new Date();
            const targetDate = new Date();
            targetDate.setDate(now.getDate() + previewOffset);
            
            const cDay = getCycleDay(targetDate);
            const phase = scheduleData.find(p => p.days.includes(cDay));
            const isToday = previewOffset === 0;
            const targetLabel = targetDate.toLocaleDateString('th-TH', { day: 'numeric', month: 'long', year: 'numeric' });

            let currentTask = null;
            let nextTask = null;
            if (phase) {
                const timeStr = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
                const sorted = [...phase.routine].sort((a,b) => a.start.localeCompare(b.start));
                for(let i=0; i < sorted.length; i++) {
                    const item = sorted[i];
                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏∞‡∏Ç‡πâ‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ô)
                    const isActive = (timeStr >= item.start && (timeStr < item.end || item.end < item.start)) || 
                                     (item.end < item.start && timeStr < item.end);
                    if (isActive) {
                        currentTask = item;
                        nextTask = sorted[i+1] || sorted[0];
                        break;
                    }
                }
                if (!currentTask) currentTask = sorted[0];
            }

            container.innerHTML = `
                <div class="space-y-6">
                    <!-- Status Card -->
                    <div class="p-1 rounded-3xl shadow-xl transition-all duration-700 ${phase?.accent || 'bg-slate-200'}">
                        <div class="bg-white rounded-[1.4rem] p-6 md:p-8 flex flex-col md:flex-row gap-8 items-center">
                            <div class="flex-1 space-y-4 w-full text-center md:text-left">
                                <div class="flex items-center justify-between">
                                    <div class="px-3 py-1 bg-slate-100 rounded-full text-[10px] font-black uppercase tracking-widest text-slate-500">
                                        Day ${cDay} of ${getCycleLength()}
                                    </div>
                                    <div class="text-[11px] font-bold text-slate-400 flex items-center gap-2" id="clock-container">
                                        <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                        <span id="realtime-clock">--:--:--</span>
                                    </div>
                                </div>
                                <div>
                                    <h2 class="text-slate-400 font-bold text-[10px] uppercase mb-1">${isToday ? '‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:' : '‡∏™‡πà‡∏≠‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤:'}</h2>
                                    <div class="text-2xl md:text-3xl font-black text-slate-800 flex items-center justify-center md:justify-start gap-4">
                                        <div class="p-3 bg-blue-50 text-blue-500 rounded-2xl">
                                            ${getIcon(currentTask?.icon || 'Sun')}
                                        </div>
                                        <span class="leading-tight">${currentTask?.task || '‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡∏≠‡∏¥‡∏™‡∏£‡∏∞'}</span>
                                    </div>
                                </div>
                                <div class="px-4 py-1.5 rounded-full inline-block text-[10px] font-black uppercase ${phase?.color || 'bg-slate-100'}">
                                    ${phase?.title || '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡∏Å‡∏∞'}
                                </div>
                            </div>

                            <!-- Progress Visual -->
                            <div class="w-40 h-40 relative flex items-center justify-center bg-slate-50 rounded-full border-4 border-slate-100 overflow-hidden shrink-0 shadow-inner">
                                <div class="absolute bottom-0 w-full bg-blue-500 progress-bar" 
                                     style="height: ${(cDay/getCycleLength())*100}%; opacity: 0.15; background-color: ${phase ? '' : '#cbd5e1'}"></div>
                                <div class="z-10 text-center">
                                    <span class="block text-6xl font-black text-slate-800 leading-none">${cDay}</span>
                                    <span class="text-[10px] font-black uppercase text-slate-400 mt-1 block">Cycle Day</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sneak Peek & Routine List -->
                    <div class="bg-white rounded-[2rem] border border-slate-100 shadow-sm overflow-hidden">
                        <div class="p-6 border-b border-slate-50 flex items-center justify-between gap-4 flex-wrap">
                            <div>
                                <h3 class="font-black text-slate-800 text-lg">${phase?.title || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}</h3>
                                <p class="text-[10px] font-bold text-blue-500 uppercase tracking-widest">${targetLabel}</p>
                            </div>
                            <div class="flex bg-slate-50 p-1.5 rounded-2xl border border-slate-100">
                                <button onclick="previewOffset--; render()" class="p-2 hover:bg-white hover:shadow-sm rounded-xl text-slate-400 transition-all active:scale-90">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="15 18 9 12 15 6"/></svg>
                                </button>
                                <button onclick="previewOffset=0; render()" class="px-5 py-1 text-[10px] font-black uppercase rounded-xl transition-all ${isToday ? 'bg-blue-500 text-white shadow-lg' : 'text-slate-400'}">Today</button>
                                <button onclick="previewOffset++; render()" class="p-2 hover:bg-white hover:shadow-sm rounded-xl text-slate-400 transition-all active:scale-90">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="9 18 15 12 9 6"/></svg>
                                </button>
                            </div>
                        </div>
                        <div class="divide-y divide-slate-50">
                            ${phase?.routine.map(item => `
                                <div class="flex items-center gap-5 p-5 transition-all hover:bg-slate-50/50">
                                    <div class="text-[11px] font-black text-slate-400 w-24 shrink-0">${item.start} - ${item.end}</div>
                                    <div class="p-2.5 bg-slate-100 rounded-xl text-slate-400 shrink-0">${getIcon(item.icon)}</div>
                                    <div class="flex-1 text-sm font-bold text-slate-700 leading-relaxed">${item.task}</div>
                                </div>
                            `).join('') || '<div class="p-10 text-center text-slate-400 italic">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</div>'}
                        </div>
                    </div>

                    <!-- Quick Setting -->
                    <div class="bg-white p-6 rounded-3xl border border-slate-100 flex flex-col md:flex-row md:items-center justify-between gap-4 shadow-sm">
                        <div class="flex items-center gap-4">
                            <div class="p-3 bg-blue-50 text-blue-500 rounded-2xl">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                            </div>
                            <div>
                                <div class="text-[10px] font-black text-slate-400 uppercase tracking-widest leading-none mb-1">Cycle Reference Date</div>
                                <input type="date" value="${startDateStr}" onchange="updateStartDate(this.value)" class="font-bold text-slate-700 outline-none border-b border-transparent hover:border-blue-200 focus:border-blue-500 transition-all">
                            </div>
                        </div>
                        <p class="text-[10px] text-slate-400 font-bold max-w-[200px] md:text-right leading-relaxed italic">
                            *‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏∞‡πÄ‡∏ä‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡πÅ‡∏£‡∏Å (Day 1) ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏à‡∏≥‡∏Ñ‡πà‡∏≤‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ‡∏ï‡∏•‡∏≠‡∏î‡πÑ‡∏õ
                        </p>
                    </div>
                </div>
            `;
            startClock();
        }

        // ‡∏´‡∏ô‡πâ‡∏≤ CALENDAR
        function renderCalendar(container) {
            const year = calendarBaseDate.getFullYear();
            const month = calendarBaseDate.getMonth();
            const firstDay = new Date(year, month, 1).getDay();
            const totalDays = new Date(year, month + 1, 0).getDate();
            const monthLabel = calendarBaseDate.toLocaleDateString('th-TH', { month: 'long', year: 'numeric' });

            let gridHTML = '';
            for (let i = 0; i < firstDay; i++) gridHTML += '<div class="aspect-square opacity-10"></div>';
            
            for (let d = 1; d <= totalDays; d++) {
                const date = new Date(year, month, d);
                const isoKey = date.toISOString().split('T')[0];
                const cDay = getCycleDay(date);
                const phase = scheduleData.find(p => p.days.includes(cDay));
                const isWeekend = date.getDay() === 0 || date.getDay() === 6;
                const holiday = THAI_HOLIDAYS[isoKey];
                const isPerfectOff = phase?.type?.includes('off') && (isWeekend || holiday);
                const isToday = new Date().toISOString().split('T')[0] === isoKey;

                gridHTML += `
                    <div onclick="jumpToDate('${isoKey}')" 
                         class="aspect-square relative flex flex-col items-center justify-center rounded-2xl border-2 cursor-pointer transition-all hover:scale-105 active:scale-95
                        ${phase?.color || 'bg-white border-slate-50'} 
                        ${isToday ? 'border-blue-500 ring-4 ring-blue-50 z-10' : 'border-transparent'}
                        ${isPerfectOff ? 'ring-2 ring-rose-300 shadow-lg' : ''}">
                        <span class="text-sm font-black ${isWeekend ? 'text-rose-500' : 'text-slate-700'}">${d}</span>
                        <span class="text-[8px] font-bold opacity-30 tracking-tighter">D${cDay}</span>
                        
                        <!-- ‡∏Ç‡∏¢‡∏≤‡∏¢ EMOJI ‡πÉ‡∏´‡πâ‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏Ç‡∏≠ -->
                        <div class="absolute top-1 right-1 flex flex-col gap-0.5">
                            ${cDay === 7 ? '<span class="text-xl drop-shadow-sm" title="‡∏£‡∏≠‡∏¢‡∏ï‡πà‡∏≠‡∏Å‡∏∞‡∏î‡∏∂‡∏Å (‡∏á‡∏µ‡∏ö‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô!)">üëª</span>' : ''}
                        </div>
                        <div class="absolute bottom-1">
                            ${isPerfectOff ? '<span class="text-2xl drop-shadow-md animate-pulse">‚ù§Ô∏è</span>' : ''}
                        </div>
                    </div>
                `;
            }

            container.innerHTML = `
                <div class="space-y-6">
                    <div class="bg-white p-5 rounded-3xl shadow-sm border border-slate-100 flex items-center justify-between">
                        <button onclick="calendarBaseDate.setMonth(calendarBaseDate.getMonth()-1); render()" class="p-2 hover:bg-slate-50 rounded-xl transition-all"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="15 18 9 12 15 6"/></svg></button>
                        <h2 class="text-lg font-black text-slate-800 uppercase tracking-tight">${monthLabel}</h2>
                        <button onclick="calendarBaseDate.setMonth(calendarBaseDate.getMonth()+1); render()" class="p-2 hover:bg-slate-50 rounded-xl transition-all"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="9 18 15 12 9 6"/></svg></button>
                    </div>
                    <div class="grid grid-cols-7 gap-3">
                        ${['‡∏≠‡∏≤','‡∏à','‡∏≠','‡∏û','‡∏û‡∏§','‡∏®','‡∏™'].map(d => `<div class="text-center text-[10px] font-black text-slate-400 py-1 uppercase tracking-widest">${d}</div>`).join('')}
                        ${gridHTML}
                    </div>
                    <div class="bg-white p-6 rounded-[2rem] border border-slate-100 flex flex-wrap items-center justify-center gap-10 shadow-sm">
                        <div class="flex items-center gap-3"><span class="text-2xl">üëª</span> <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest leading-none">Ghost Nap Transition</span></div>
                        <div class="flex items-center gap-3"><span class="text-2xl">‚ù§Ô∏è</span> <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest leading-none">Perfect OFF Match</span></div>
                    </div>
                </div>
            `;
        }

        // ‡∏´‡∏ô‡πâ‡∏≤ EDITOR
        function renderEditor(container) {
            container.innerHTML = `
                <div class="space-y-6 pb-10">
                    <div class="bg-white p-6 rounded-3xl border border-slate-100 flex flex-col md:flex-row justify-between items-center gap-4 shadow-sm">
                        <div>
                            <h2 class="text-xl font-black text-slate-800">Advanced Schedule Editor</h2>
                            <p class="text-xs text-slate-400 font-bold uppercase tracking-widest">Custom Cycle Mode</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="exportData()" class="px-4 py-2 bg-slate-50 hover:bg-slate-100 rounded-xl text-xs font-bold transition-all flex items-center gap-2 border border-slate-100">Export JSON</button>
                            <button onclick="document.getElementById('file-input').click()" class="px-4 py-2 bg-slate-50 hover:bg-slate-100 rounded-xl text-xs font-bold transition-all flex items-center gap-2 border border-slate-100">Import JSON</button>
                            <input type="file" id="file-input" class="hidden" onchange="importData(event)">
                        </div>
                    </div>

                    <div id="editor-list" class="space-y-6">
                        ${scheduleData.map((phase, pIdx) => `
                            <div class="bg-white rounded-[2.5rem] border border-slate-100 shadow-sm overflow-hidden">
                                <div class="p-1.5 ${phase.accent}"></div>
                                <div class="p-8 space-y-5">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div class="space-y-1">
                                            <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest">‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ / ‡∏Å‡∏∞</label>
                                            <input value="${phase.title}" onchange="updatePhase(${pIdx}, 'title', this.value)" class="w-full text-lg font-black text-slate-800 border-b-2 border-transparent focus:border-blue-400 outline-none pb-1 bg-slate-50/30 px-2 rounded-lg" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏∞‡πÄ‡∏ä‡πâ‡∏≤">
                                        </div>
                                        <div class="space-y-1">
                                            <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ô‡∏£‡∏≠‡∏ö (Cycle Days)</label>
                                            <input value="${phase.days.join(',')}" onchange="updatePhase(${pIdx}, 'days', this.value.split(',').map(n=>parseInt(n.trim())).filter(n=>!isNaN(n)))" class="w-full font-bold text-slate-500 border-b-2 border-transparent focus:border-blue-400 outline-none pb-1 bg-slate-50/30 px-2 rounded-lg" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1,2,3">
                                        </div>
                                    </div>
                                    
                                    <div class="space-y-3">
                                        <h4 class="text-[10px] font-black text-slate-400 uppercase tracking-widest">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏ô‡∏£‡∏π‡∏ó‡∏µ‡∏ô</h4>
                                        <div class="space-y-2">
                                            ${phase.routine.map((r, rIdx) => `
                                                <div class="flex flex-col md:flex-row gap-2 bg-slate-50 p-4 rounded-2xl group border border-slate-100">
                                                    <div class="flex gap-2 w-full md:w-auto">
                                                        <input value="${r.start}" onchange="updateRoutine(${pIdx}, ${rIdx}, 'start', this.value)" class="w-16 text-[10px] font-bold px-2 py-1.5 rounded-lg border border-slate-200 outline-none focus:border-blue-500">
                                                        <span class="text-slate-300 self-center">-</span>
                                                        <input value="${r.end}" onchange="updateRoutine(${pIdx}, ${rIdx}, 'end', this.value)" class="w-16 text-[10px] font-bold px-2 py-1.5 rounded-lg border border-slate-200 outline-none focus:border-blue-500">
                                                    </div>
                                                    <input value="${r.task}" onchange="updateRoutine(${pIdx}, ${rIdx}, 'task', this.value)" class="flex-1 text-xs font-bold px-4 py-1.5 rounded-lg border border-slate-200 outline-none focus:border-blue-500">
                                                    <button onclick="removeActivity(${pIdx}, ${rIdx})" class="text-rose-300 hover:text-rose-500 transition-colors p-2"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg></button>
                                                </div>
                                            `).join('')}
                                            <button onclick="addActivity(${pIdx})" class="w-full py-3 border-2 border-dashed border-slate-100 rounded-2xl text-[10px] font-black text-slate-400 uppercase tracking-widest hover:bg-slate-50 hover:border-blue-200 hover:text-blue-400 transition-all mt-2">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                        
                        <button onclick="addPhase()" class="w-full p-8 border-2 border-dashed border-slate-200 rounded-[2.5rem] text-slate-400 font-black uppercase tracking-widest hover:border-blue-300 hover:text-blue-500 hover:bg-white transition-all">+ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡πà‡∏ß‡∏á‡∏Å‡∏∞‡πÉ‡∏´‡∏°‡πà</button>
                    </div>

                    <div class="p-10 bg-blue-600 rounded-[2.5rem] text-white shadow-2xl shadow-blue-200 text-center space-y-6">
                        <div class="inline-block p-4 bg-white/20 rounded-3xl mb-2">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v13a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                        </div>
                        <h3 class="text-2xl font-black uppercase tracking-tight">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß!</h3>
                        <p class="text-sm opacity-80 leading-relaxed max-w-sm mx-auto">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠</p>
                        <button onclick="goToDashboard()" class="w-full bg-white text-blue-600 py-4 rounded-2xl font-black uppercase tracking-widest hover:bg-blue-50 transition-all active:scale-95 shadow-xl">Back to Dashboard</button>
                        <button onclick="if(confirm('‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô? ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ')) resetData()" class="text-[10px] font-bold uppercase tracking-widest opacity-50 hover:opacity-100">Reset to Default</button>
                    </div>
                </div>
            `;
        }

        /**
         * 5. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (SUPPORTING ACTIONS)
         */

        let clockInterval = null;
        function startClock() {
            if(clockInterval) clearInterval(clockInterval);
            const update = () => {
                const clockEl = document.getElementById('realtime-clock');
                if(clockEl) clockEl.innerText = new Date().toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            };
            update();
            clockInterval = setInterval(update, 1000);
        }

        function saveData() {
            localStorage.setItem('hybrid_schedule_v1', JSON.stringify(scheduleData));
            localStorage.setItem('hybrid_start_date', startDateStr);
        }

        function resetData() {
            scheduleData = JSON.parse(JSON.stringify(DEFAULT_SCHEDULE));
            saveData();
            render();
        }

        function updateStartDate(val) {
            startDateStr = val;
            saveData();
            render();
        }

        function goToDashboard() {
            previewOffset = 0;
            changeView('dashboard');
        }

        function jumpToDate(isoStr) {
            const today = new Date();
            today.setHours(0,0,0,0);
            const target = new Date(isoStr);
            const diffDays = Math.floor((target.getTime() - today.getTime()) / (1000 * 60 * 60 * 24));
            previewOffset = diffDays;
            changeView('dashboard');
        }

        // Editor Functions
        function updatePhase(idx, field, val) { scheduleData[idx][field] = val; saveData(); }
        function updateRoutine(pIdx, rIdx, field, val) { scheduleData[pIdx].routine[rIdx][field] = val; saveData(); }
        function addActivity(pIdx) { scheduleData[pIdx].routine.push({start:'09:00', end:'10:00', task:'‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà', icon:'Clock'}); saveData(); render(); }
        function removeActivity(pIdx, rIdx) { scheduleData[pIdx].routine.splice(rIdx, 1); saveData(); render(); }
        function addPhase() { scheduleData.push({id: Date.now(), title:'Phase ‡πÉ‡∏´‡∏°‡πà', days:[], accent:'bg-blue-500', color:'bg-blue-50', routine:[]}); saveData(); render(); }

        // Export/Import
        function exportData() {
            const data = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(scheduleData, null, 2));
            const a = document.createElement('a');
            a.href = data; a.download = "hybrid_engineer_schedule.json"; a.click();
        }

        function importData(e) {
            const file = e.target.files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
                try {
                    const json = JSON.parse(ev.target.result);
                    scheduleData = json; saveData(); changeView('dashboard');
                } catch(e) { alert('‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'); }
            };
            reader.readAsText(file);
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏≠‡∏õ
        render();

    </script>
</body>
</html>
